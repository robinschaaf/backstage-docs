<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<meta http-equiv="x-ua-compatible" content="IE=edge"></meta><meta name="format-detection" content="telephone=no"></meta><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"></meta><meta name="search" content="default"></meta><meta name="use.ic" content="no"></meta><meta name="tocstandalone" content="no"></meta><script type="text/javascript">
			var index;
			var contentLanguage = 'en';
			var enterKey = 'select';
			
					var anchoroption = true;
				
				var fuse_threshold = 0.3;
			
					var local_csh = false;
				
			var useanchorlinks = false;
			</script><title>CashComplete™ On-Device purchases</title><link rel="stylesheet" type="text/css" href="../css/docbook.css"></link><link rel="stylesheet" type="text/css" href="../css/bootstrap.min.css"></link><link rel="stylesheet" type="text/css" href="../css/bootstrap-theme.min.css"></link><link rel="stylesheet" type="text/css" href="../css/font-awesome.css"></link><link rel="stylesheet" type="text/css" href="../css/roboto.font.css"></link><link rel="stylesheet" type="text/css" href="../css/sm-core-css.css"></link><link rel="stylesheet" type="text/css" href="../css/sm-simple.css"></link><link rel="stylesheet" type="text/css" href="../css/style-print.css"></link><link rel="stylesheet" type="text/css" href="../css/style-common.css"></link><link rel="stylesheet" type="text/css" href="../css/style.css"></link><link rel="stylesheet" type="text/css" href="../css/style-responsive.css"></link><script src="../js/jquery-1.10.2.min.js" type="text/javascript"></script><script src="../js/jquery-ui-1.10.3.custom.min.js" type="text/javascript"></script><script src="../js/materialize.min.js" type="text/javascript"></script><script src="../js/bootstrap.min.js" type="text/javascript"></script><script src="../js/purl.js" type="text/javascript"></script><script src="../js/jquery.event.move.js" type="text/javascript"></script><script src="../js/jquery.event.swipe.js" type="text/javascript"></script><script src="../js/jquery.sticky.js" type="text/javascript"></script><script src="../js/respond.min.js" type="text/javascript"></script><script src="../js/script.js" type="text/javascript"></script><script src="../js/clipboard.min.js" type="text/javascript"></script><script src="../js/lunr.js" type="text/javascript"></script><script src="../js/jquery.mark.min.js" type="text/javascript"></script><script src="js/data.js" type="text/javascript"></script><script src="../js/search.js" type="text/javascript"></script><script src="../js/csh.js" type="text/javascript"></script><meta name="generator" content="Paligo"></meta><link rel="prev" href="UUID-28d0d578-3fa4-4bc2-cb29-0f487a077613.html" title="Purchases, payments, and kiosks"></link><link rel="next" href="UUID-7311a90b-969c-17e6-cc79-2c1844c91ce1.html" title="Kiosk application — workflow"></link><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML" async="async"></script><link rel="icon" href="/favicon.ico" type="image/x-icon"></link><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.2/styles/default.min.css"></link><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.2/highlight.min.js"></script><script type="text/javascript">
			$(document).ready(function() {
				
				$('pre:not(.embedcode)').each(function() {
					/**
					 * @type {string}
					 */
					var language = $(this).data('language');

					if (language === 'plaintext' || language === 'text') {
						$(this).addClass(language).addClass('hljs');
						return true;
					}
					else {
						var clone = this.cloneNode(true);
						hljs.highlightBlock(clone);
						$(this).empty().append($(clone).contents());
						$(this).attr("class", $(clone).attr("class"));
					}
				});
			});
			</script></head><body xmlns:php="http://php.net/xsl" data-link-prefix=""><div id="page" class="clearfix"><div id="header"><div class="container"><div id="logotype-container" class="pull-left"><a href="../index.html"><img id="logotype-pageheader" src="../css/image/corporate-logo.png" alt="Corporate logotype" data-role="logotype"></img></a></div><div id="pagetools-container" class="pull-right"><ul id="page-tools"><li class="page-tools-search"><input placeholder="Search" type="text" class="form-control" id="search"></input></li><li class="page-tools-print"><a href="javascript:window.print();"><span class="tool-label">Print</span><span class="glyphicon glyphicon-print"></span></a></li></ul></div></div></div><h1 id="publication-title"><span class="phrase">CashComplete™ On-Device</span> Software Development Kit Guide version 3.0.0</h1><div id="subheader-sticky-wrapper" class="sticky-wrapper"><div id="subheader"><div class="container"><div class="row"><div class="col-md-3 toc-title"><h2><a class="prev nav-icon hidden-lg hidden-md" href="UUID-28d0d578-3fa4-4bc2-cb29-0f487a077613.html"><span class="glyphicon glyphicon-chevron-left"></span> </a><a href="#toc" class="hidden mobile-nav-toggle"><span class="glyphicon glyphicon-list"></span>Table of Contents</a><span class="toc-label">Table of Contents</span><a class="next nav-icon hidden-lg hidden-md" href="UUID-7311a90b-969c-17e6-cc79-2c1844c91ce1.html"><span class="glyphicon glyphicon-chevron-right"></span> </a></h2></div><div class="col-md-9 breadcrumb-container"><ul class="breadcrumb"><li class="breadcrumb-link"><span class="glyphicon glyphicon-home"></span> <a href="index-en.html"><span class="phrase">CashComplete™ On-Device</span> Software Development Kit Guide version 3.0.0</a></li><li class="breadcrumb-link"><a href="UUID-a90722ac-fd27-8578-43bf-25ec725be647.html">CashComplete™ On-Device Software Development Kit Guide</a></li><li class="breadcrumb-link"><a href="UUID-28d0d578-3fa4-4bc2-cb29-0f487a077613.html">Purchases, payments, and kiosks</a></li><li class="breadcrumb-node"><span class="phrase">CashComplete™ On-Device</span> purchases</li></ul></div></div></div></div></div><div id="main-content"><div class="container"><div class="row"><div class="col-md-3 toc-container" id="toc-wrapper"><div id="toc-placeholder"><ul class="toc"><li><a href="UUID-a90722ac-fd27-8578-43bf-25ec725be647.html" class="topic-link"><span class="glyphicon glyphicon-chevron-right"></span> CashComplete™ On-Device Software Development Kit Guide</a><ul><li><a href="UUID-f95b3142-bdb2-0879-4dc9-5f0daac9b0bb.html" class="topic-link">User license agreement for PayComplete software</a></li><li><a href="UUID-2818c4e4-7c3e-a7a2-9a52-7769bcbf2f2f.html" class="topic-link">CashComplete™ On-Device and SDK compatibility matrix</a></li><li><a href="UUID-d2936ece-4207-e9a7-4c18-02fdf9b58ec2.html" class="topic-link">SDK documentation</a></li><li><a href="UUID-448d6bf9-75b2-362a-4278-c415bfd6b198.html" class="topic-link"><span class="glyphicon glyphicon-chevron-right"></span> Getting started with JDK</a><ul><li><a href="UUID-9cdaf9cd-b405-3fd4-3756-857e1618153d.html" class="topic-link">Setting up the JDK workspace</a></li><li><a href="UUID-9fc1b8c2-e957-b10b-391c-8751a2dde4f2.html" class="topic-link">Implementing a JDK plug-in</a></li><li><a href="UUID-9bd9d62b-dab7-4f0f-8bff-e7575d67d5ed.html" class="topic-link">Compiling a JDK plug-in</a></li><li><a href="UUID-e88e8bfa-591a-6c32-3131-970e449fafc9.html" class="topic-link">Installing a JDK plug-in</a></li></ul></li><li><a href="UUID-d55347a6-a74a-871d-4e52-d5ae920984f8.html" class="topic-link"><span class="glyphicon glyphicon-chevron-right"></span> Getting started with Eclipse</a><ul><li><a href="UUID-7dc0d9cc-a870-58bd-707a-d9dc282095be.html" class="topic-link">Setting up the Eclipse workspace</a></li><li><a href="UUID-d2b1e921-9643-0d47-6514-b50506884804.html" class="topic-link">Implementing an Eclipse plug-in</a></li><li><a href="UUID-b71af4e8-8c9f-348f-b545-d8ab425b999f.html" class="topic-link">Compiling an Eclipse plug-in</a></li><li><a href="UUID-a7d5b6d7-94d7-6e45-4e73-502014e5f079.html" class="topic-link">Installing an Eclipse plug-in</a></li></ul></li><li><a href="UUID-7318a2d9-4028-1f8d-f5c5-56a7166ed74d.html" class="topic-link"><span class="glyphicon glyphicon-chevron-right"></span> Inside the SDK</a><ul><li><a href="UUID-a42da773-7b3b-0d4b-ad89-0a6fe86e2fe5.html" class="topic-link">Compiling an SDK plug-in</a></li><li><a href="UUID-e77b5766-58ad-3def-4fc8-bf97e71004ed.html" class="topic-link">Installing an SDK plug-in</a></li><li><a href="UUID-c854a932-408e-e97c-bdb6-a2eb0d880e28.html" class="topic-link">SDK architecture</a></li><li><a href="UUID-964d2e7f-09f7-fa43-321b-b67c706e600c.html" class="topic-link">SDK flows</a></li><li><a href="UUID-2ac7e401-fef8-9b3c-2332-ec56efd8ceb3.html" class="topic-link">CashComplete™ On-Device and plug-in flowchart</a></li><li><a href="UUID-7cd7ffff-cd2e-88dd-3058-e655930232f8.html" class="topic-link">SDK managers</a></li><li><a href="UUID-ca45f3e6-b822-6cbb-8be8-16de54a34ca5.html" class="topic-link">CashComplete™ On-Device sessions</a></li><li><a href="UUID-d722c35d-ceca-013d-c8f3-d9ba476f9919.html" class="topic-link">CashComplete™ On-Device permissions</a></li><li><a href="UUID-cdf34923-71a5-721d-1a1f-7a1e0fc0dce6.html" class="topic-link">CashComplete™ On-Device operator service menu</a></li><li><a href="UUID-c467f34c-3db9-9860-b34f-18bf1612fa7f.html" class="topic-link">Custom device integration</a></li></ul></li><li><a href="UUID-24f67e04-0ea1-2411-fbb4-6444c10be3be.html" class="topic-link"><span class="glyphicon glyphicon-chevron-right"></span> SDK troubleshooting</a><ul><li><a href="UUID-5061e5d4-ffa7-293a-474f-e9f827119caa.html" class="topic-link">Plug-in does not seem to start</a></li><li><a href="UUID-5e85eb81-eb71-5334-cbce-f2f8fc9f2d29.html" class="topic-link">There is no button for a plug-in service</a></li><li><a href="UUID-2689cf83-1a8d-7959-8b01-db48c94ed4f1.html" class="topic-link">CashComplete™ On-Device does not seem to start</a></li><li><a href="UUID-66315ac4-fbac-fdac-3760-85189928b385.html" class="topic-link">IOJDepositManager.beginTransaction() becomes unresponsive</a></li></ul></li><li><a href="UUID-901e1ea4-0868-7aae-f60a-6bedc6ecfa0d.html" class="topic-link"><span class="glyphicon glyphicon-chevron-right"></span> SDK examples — prerequisites</a><ul><li><a href="UUID-d06944a7-6886-3d51-e69e-390225773217.html" class="topic-link">Compiling and installing examples</a></li><li><a href="UUID-ba1e99ec-4640-b4b9-0c82-2cd0bc3d569f.html" class="topic-link">Example plug-ins</a></li></ul></li><li><a href="UUID-bb541365-4925-7f31-7db5-27b9902aeeac.html" class="topic-link">SDK 3.0.0 - configuration handling</a></li><li><a href="UUID-83b41fe1-9cbd-ff16-c99f-02f4473d914a.html" class="topic-link"><span class="glyphicon glyphicon-chevron-right"></span> SDK 2.0.0</a><ul><li><a href="UUID-d5773f11-97c2-ddc9-ef78-fed8029fd98f.html" class="topic-link">New user interface framework</a></li><li><a href="UUID-636c17aa-7f0d-bffe-e77c-0ffda4bd3d3c.html" class="topic-link">Known flows launching process</a></li><li><a href="UUID-0aa70923-d132-3015-a381-2af11f2c5ef7.html" class="topic-link">SDK 2.0.0 - miscellaneous information</a></li></ul></li><li><a href="UUID-f5224b30-6ab9-7d7e-2758-993c7718b233.html" class="topic-link">Icons for services</a></li><li><a href="UUID-28d0d578-3fa4-4bc2-cb29-0f487a077613.html" class="topic-link"><span class="glyphicon glyphicon-chevron-right"></span> Purchases, payments, and kiosks</a><ul><li><a href="UUID-8398b260-6cfe-d571-f922-1cac53f59915.html" class="topic-link">CashComplete™ On-Device purchases</a></li><li><a href="UUID-7311a90b-969c-17e6-cc79-2c1844c91ce1.html" class="topic-link">Kiosk application — workflow</a></li><li><a href="UUID-9327879b-213e-e89b-9407-e2701d5f302d.html" class="topic-link">Advanced kiosk features</a></li><li><a href="UUID-2558a1cc-0b30-bc42-a498-0eb806eb80eb.html" class="topic-link">Purchase accounting</a></li></ul></li><li><a href="UUID-8c537626-5f5c-af1d-46e8-7c6feb1edec1.html" class="topic-link">Revision history</a></li></ul></li></ul></div></div><div class="col-md-9 content-container" id="content-wrapper"><a accesskey="p" id="header-navigation-prev" class="pull-left prev visible-lg visible-md" href="UUID-28d0d578-3fa4-4bc2-cb29-0f487a077613.html"><span class="glyphicon glyphicon-circle-arrow-left"></span>Prev</a><a accesskey="n" id="header-navigation-next" class="pull-right next visible-lg visible-md" href="UUID-7311a90b-969c-17e6-cc79-2c1844c91ce1.html">Next<span class="glyphicon glyphicon-circle-arrow-right"></span></a><div id="topic-content"><section xml:lang="en" lang="en" dir="ltr" class="section" data-origin-id="UUID-7ec29a04-9f10-eb18-21fd-c32f544663e6" data-publication-date="" id="UUID-8398b260-6cfe-d571-f922-1cac53f59915"><div class="titlepage"><div><div class="title"><h4 class="title"><span class="phrase">CashComplete™ On-Device</span> purchases</h4></div></div></div><p>There is more to a purchase than just a deposit followed by a dispense of the change.</p><p>First of all, it may involve cashless payments, that is payments done by credit cards, debit cards or loyalty cards.</p><div dir="ltr" class="note"><h3 class="title">Note</h3><p>Cashless payments done by credit cards, debit cards or loyalty cards is supported in <span class="phrase">CashComplete™ On-Device</span> from version 3.11.0 and SDK version 2.2.0.</p></div><p>You also need to consider the following:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The concept of products and the different aspects of different products.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>The types of payment acceptable for a certain product</p></li><li class="listitem"><p>Different price lists for different payment forms</p></li><li class="listitem"><p>Whether or not a certain product is subject to VAT</p></li><li class="listitem"><p>Names of products and product groups</p></li></ul></div></li><li class="listitem"><p>Managing VAT — There is more to VAT than just calculating a percentage. Maybe not all products or types of payment are subject to VAT.</p></li><li class="listitem"><p>Printing purchase receipts with the proper information</p></li><li class="listitem"><p>Handling of over-payments — both when the customer paid too much and when products weren't delivered</p></li><li class="listitem"><p>Managing credits for the customer due to over-payments that couldn’t or weren't supposed to be refunded</p></li><li class="listitem"><p>Printing refund vouchers for remaining credits</p></li><li class="listitem"><p>Reporting all of the above to <span class="phrase">CashComplete™ Connect</span> or another back-end system for full purchase accounting purposes</p></li></ul></div><p>You can now manage all of the above from the <span class="phrase">CashComplete™ On-Device</span> purchase user interface and the new SDK in a way that reduces the complexity for anyone who writes the kiosk application. The core purchase management in <span class="phrase">CashComplete™ On-Device</span> also provides an improved cash exchange functionality.</p><div dir="ltr" class="note"><h3 class="title">Note</h3><p>Cash exchange can be seen as a purchase of cash.</p></div><div class="informalexample seealso"><p>See also</p><p><a class="xref" href="UUID-28d0d578-3fa4-4bc2-cb29-0f487a077613.html" title="Purchases, payments, and kiosks"><span class="xreftitle">Purchases, payments, and kiosks</span></a></p><p><a class="xref" href="UUID-8398b260-6cfe-d571-f922-1cac53f59915.html#UUID-1955240a-5475-3b70-cef1-423cf87e0098" title="Simple purchase procedure"><span class="xreftitle">Simple purchase procedure</span></a></p></div><section xml:lang="en" lang="en" dir="ltr" class="section" data-origin-id="UUID-4af11d1c-20df-6e8b-38cc-8d2d5ea931f0" data-publication-date="" id="UUID-1955240a-5475-3b70-cef1-423cf87e0098"><div class="titlepage"><div><div class="title"><h5 class="title">Simple purchase procedure</h5></div></div></div><p>A purchase consists of the following steps:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Initiate the purchase</p></li><li class="listitem"><p>Ask for the payment</p></li><li class="listitem"><p>Deliver the products and mark them as delivered (if step 2 was successful)</p></li><li class="listitem"><p>Pay change (both due to over-payments and products that weren't delivered)</p></li><li class="listitem"><p>End the purchase (this sends events and registers remaining credits)</p></li><li class="listitem"><p>Print a purchase receipt</p></li></ol></div><p>In code, it looks like this:</p><div dir="ltr" class="note"><h3 class="title">Note</h3><p>The user must be logged in during the entire sequence.</p></div><pre class="programlisting java" data-language="java">IOJPurchaseManager purchaseManager = session.getPurchaseManager();
IOJProduct product = purchaseManager.createProduct(
        "My Product Group",
        "My Product Name",
        new OJPriceTableEntry( 100, 100 ),    // Cash price (value: 1€, price: 1€)
        new OJPriceTableEntry( 100, 100 ),    // Credit card price
        new OJPriceTableEntry( 100, 100 ) );  // Loyalty card price

purchaseManager.beginPurchase(
        Currency.getInstance( "EUR" ),  // Currency for the purchase
        10f );
boolean result = purchaseManager.doPayment(
        Arrays.asList( product ),
        Arrays.asList( PaymentType.values() ), // Accept all payment types
        new IOJPaymentListener()
        {
            @Override
            public void setCancelPossible( boolean cancelPossible )
            {
                // Update GUI
            }

            @Override
            public void updatePayment( OJMoneyBag paid )
            {
                // Update GUI
            }

            @Override
            public void externalPayment()
            {
                // Update GUI
            }

            @Override
            public void externalPaymentAborted( AbortReason reason )
            {
                // Update GUI
            }
        } );

if ( result )
{
    // Add special code to actually deliver the product
    // ...
    product.setDelivered( true, null, "", -1 );
}

purchaseManager.payChange();

purchaseManager.endPurchase();

try
{
    session.getDeviceManager().getPrinter().printStandardReceipt(
            OJStandardReceiptType.PURCHASE );
}
catch ( OJPrinterException e )
{
}
</pre><div class="informalexample seealso" id="UUID-1955240a-5475-3b70-cef1-423cf87e0098_informalexample-idm33207950209766"><p>See also</p><p><a class="xref" href="UUID-8398b260-6cfe-d571-f922-1cac53f59915.html" title="CashComplete™ On-Device purchases"><span class="xreftitle"><span class="phrase">CashComplete™ On-Device</span> purchases</span></a></p></div></section></section><div class="footer-content"><div class="additional-links"></div></div><footer></footer></div></div></div></div></div></div></body></html>
