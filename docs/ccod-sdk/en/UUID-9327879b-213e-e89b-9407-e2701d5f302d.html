<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<meta http-equiv="x-ua-compatible" content="IE=edge"></meta><meta name="format-detection" content="telephone=no"></meta><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"></meta><meta name="search" content="default"></meta><meta name="use.ic" content="no"></meta><meta name="tocstandalone" content="no"></meta><script type="text/javascript">
			var index;
			var contentLanguage = 'en';
			var enterKey = 'select';
			
					var anchoroption = true;
				
				var fuse_threshold = 0.3;
			
					var local_csh = false;
				
			var useanchorlinks = false;
			</script><title>Advanced kiosk features</title><link rel="stylesheet" type="text/css" href="../css/docbook.css"></link><link rel="stylesheet" type="text/css" href="../css/bootstrap.min.css"></link><link rel="stylesheet" type="text/css" href="../css/bootstrap-theme.min.css"></link><link rel="stylesheet" type="text/css" href="../css/font-awesome.css"></link><link rel="stylesheet" type="text/css" href="../css/roboto.font.css"></link><link rel="stylesheet" type="text/css" href="../css/sm-core-css.css"></link><link rel="stylesheet" type="text/css" href="../css/sm-simple.css"></link><link rel="stylesheet" type="text/css" href="../css/style-print.css"></link><link rel="stylesheet" type="text/css" href="../css/style-common.css"></link><link rel="stylesheet" type="text/css" href="../css/style.css"></link><link rel="stylesheet" type="text/css" href="../css/style-responsive.css"></link><script src="../js/jquery-1.10.2.min.js" type="text/javascript"></script><script src="../js/jquery-ui-1.10.3.custom.min.js" type="text/javascript"></script><script src="../js/materialize.min.js" type="text/javascript"></script><script src="../js/bootstrap.min.js" type="text/javascript"></script><script src="../js/purl.js" type="text/javascript"></script><script src="../js/jquery.event.move.js" type="text/javascript"></script><script src="../js/jquery.event.swipe.js" type="text/javascript"></script><script src="../js/jquery.sticky.js" type="text/javascript"></script><script src="../js/respond.min.js" type="text/javascript"></script><script src="../js/script.js" type="text/javascript"></script><script src="../js/clipboard.min.js" type="text/javascript"></script><script src="../js/lunr.js" type="text/javascript"></script><script src="../js/jquery.mark.min.js" type="text/javascript"></script><script src="js/data.js" type="text/javascript"></script><script src="../js/search.js" type="text/javascript"></script><script src="../js/csh.js" type="text/javascript"></script><meta name="generator" content="Paligo"></meta><link rel="prev" href="UUID-7311a90b-969c-17e6-cc79-2c1844c91ce1.html" title="Kiosk application — workflow"></link><link rel="next" href="UUID-2558a1cc-0b30-bc42-a498-0eb806eb80eb.html" title="Purchase accounting"></link><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML" async="async"></script><link rel="icon" href="/favicon.ico" type="image/x-icon"></link><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.2/styles/default.min.css"></link><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.2/highlight.min.js"></script><script type="text/javascript">
			$(document).ready(function() {
				
				$('pre:not(.embedcode)').each(function() {
					/**
					 * @type {string}
					 */
					var language = $(this).data('language');

					if (language === 'plaintext' || language === 'text') {
						$(this).addClass(language).addClass('hljs');
						return true;
					}
					else {
						var clone = this.cloneNode(true);
						hljs.highlightBlock(clone);
						$(this).empty().append($(clone).contents());
						$(this).attr("class", $(clone).attr("class"));
					}
				});
			});
			</script></head><body xmlns:php="http://php.net/xsl" data-link-prefix=""><div id="page" class="clearfix"><div id="header"><div class="container"><div id="logotype-container" class="pull-left"><a href="../index.html"><img id="logotype-pageheader" src="../css/image/corporate-logo.png" alt="Corporate logotype" data-role="logotype"></img></a></div><div id="pagetools-container" class="pull-right"><ul id="page-tools"><li class="page-tools-search"><input placeholder="Search" type="text" class="form-control" id="search"></input></li><li class="page-tools-print"><a href="javascript:window.print();"><span class="tool-label">Print</span><span class="glyphicon glyphicon-print"></span></a></li></ul></div></div></div><h1 id="publication-title"><span class="phrase">CashComplete™ On-Device</span> Software Development Kit Guide version 3.0.0</h1><div id="subheader-sticky-wrapper" class="sticky-wrapper"><div id="subheader"><div class="container"><div class="row"><div class="col-md-3 toc-title"><h2><a class="prev nav-icon hidden-lg hidden-md" href="UUID-7311a90b-969c-17e6-cc79-2c1844c91ce1.html"><span class="glyphicon glyphicon-chevron-left"></span> </a><a href="#toc" class="hidden mobile-nav-toggle"><span class="glyphicon glyphicon-list"></span>Table of Contents</a><span class="toc-label">Table of Contents</span><a class="next nav-icon hidden-lg hidden-md" href="UUID-2558a1cc-0b30-bc42-a498-0eb806eb80eb.html"><span class="glyphicon glyphicon-chevron-right"></span> </a></h2></div><div class="col-md-9 breadcrumb-container"><ul class="breadcrumb"><li class="breadcrumb-link"><span class="glyphicon glyphicon-home"></span> <a href="index-en.html"><span class="phrase">CashComplete™ On-Device</span> Software Development Kit Guide version 3.0.0</a></li><li class="breadcrumb-link"><a href="UUID-a90722ac-fd27-8578-43bf-25ec725be647.html">CashComplete™ On-Device Software Development Kit Guide</a></li><li class="breadcrumb-link"><a href="UUID-28d0d578-3fa4-4bc2-cb29-0f487a077613.html">Purchases, payments, and kiosks</a></li><li class="breadcrumb-node">Advanced kiosk features</li></ul></div></div></div></div></div><div id="main-content"><div class="container"><div class="row"><div class="col-md-3 toc-container" id="toc-wrapper"><div id="toc-placeholder"><ul class="toc"><li><a href="UUID-a90722ac-fd27-8578-43bf-25ec725be647.html" class="topic-link"><span class="glyphicon glyphicon-chevron-right"></span> CashComplete™ On-Device Software Development Kit Guide</a><ul><li><a href="UUID-f95b3142-bdb2-0879-4dc9-5f0daac9b0bb.html" class="topic-link">User license agreement for PayComplete software</a></li><li><a href="UUID-2818c4e4-7c3e-a7a2-9a52-7769bcbf2f2f.html" class="topic-link">CashComplete™ On-Device and SDK compatibility matrix</a></li><li><a href="UUID-d2936ece-4207-e9a7-4c18-02fdf9b58ec2.html" class="topic-link">SDK documentation</a></li><li><a href="UUID-448d6bf9-75b2-362a-4278-c415bfd6b198.html" class="topic-link"><span class="glyphicon glyphicon-chevron-right"></span> Getting started with JDK</a><ul><li><a href="UUID-9cdaf9cd-b405-3fd4-3756-857e1618153d.html" class="topic-link">Setting up the JDK workspace</a></li><li><a href="UUID-9fc1b8c2-e957-b10b-391c-8751a2dde4f2.html" class="topic-link">Implementing a JDK plug-in</a></li><li><a href="UUID-9bd9d62b-dab7-4f0f-8bff-e7575d67d5ed.html" class="topic-link">Compiling a JDK plug-in</a></li><li><a href="UUID-e88e8bfa-591a-6c32-3131-970e449fafc9.html" class="topic-link">Installing a JDK plug-in</a></li></ul></li><li><a href="UUID-d55347a6-a74a-871d-4e52-d5ae920984f8.html" class="topic-link"><span class="glyphicon glyphicon-chevron-right"></span> Getting started with Eclipse</a><ul><li><a href="UUID-7dc0d9cc-a870-58bd-707a-d9dc282095be.html" class="topic-link">Setting up the Eclipse workspace</a></li><li><a href="UUID-d2b1e921-9643-0d47-6514-b50506884804.html" class="topic-link">Implementing an Eclipse plug-in</a></li><li><a href="UUID-b71af4e8-8c9f-348f-b545-d8ab425b999f.html" class="topic-link">Compiling an Eclipse plug-in</a></li><li><a href="UUID-a7d5b6d7-94d7-6e45-4e73-502014e5f079.html" class="topic-link">Installing an Eclipse plug-in</a></li></ul></li><li><a href="UUID-7318a2d9-4028-1f8d-f5c5-56a7166ed74d.html" class="topic-link"><span class="glyphicon glyphicon-chevron-right"></span> Inside the SDK</a><ul><li><a href="UUID-a42da773-7b3b-0d4b-ad89-0a6fe86e2fe5.html" class="topic-link">Compiling an SDK plug-in</a></li><li><a href="UUID-e77b5766-58ad-3def-4fc8-bf97e71004ed.html" class="topic-link">Installing an SDK plug-in</a></li><li><a href="UUID-c854a932-408e-e97c-bdb6-a2eb0d880e28.html" class="topic-link">SDK architecture</a></li><li><a href="UUID-964d2e7f-09f7-fa43-321b-b67c706e600c.html" class="topic-link">SDK flows</a></li><li><a href="UUID-2ac7e401-fef8-9b3c-2332-ec56efd8ceb3.html" class="topic-link">CashComplete™ On-Device and plug-in flowchart</a></li><li><a href="UUID-7cd7ffff-cd2e-88dd-3058-e655930232f8.html" class="topic-link">SDK managers</a></li><li><a href="UUID-ca45f3e6-b822-6cbb-8be8-16de54a34ca5.html" class="topic-link">CashComplete™ On-Device sessions</a></li><li><a href="UUID-d722c35d-ceca-013d-c8f3-d9ba476f9919.html" class="topic-link">CashComplete™ On-Device permissions</a></li><li><a href="UUID-cdf34923-71a5-721d-1a1f-7a1e0fc0dce6.html" class="topic-link">CashComplete™ On-Device operator service menu</a></li><li><a href="UUID-c467f34c-3db9-9860-b34f-18bf1612fa7f.html" class="topic-link">Custom device integration</a></li></ul></li><li><a href="UUID-24f67e04-0ea1-2411-fbb4-6444c10be3be.html" class="topic-link"><span class="glyphicon glyphicon-chevron-right"></span> SDK troubleshooting</a><ul><li><a href="UUID-5061e5d4-ffa7-293a-474f-e9f827119caa.html" class="topic-link">Plug-in does not seem to start</a></li><li><a href="UUID-5e85eb81-eb71-5334-cbce-f2f8fc9f2d29.html" class="topic-link">There is no button for a plug-in service</a></li><li><a href="UUID-2689cf83-1a8d-7959-8b01-db48c94ed4f1.html" class="topic-link">CashComplete™ On-Device does not seem to start</a></li><li><a href="UUID-66315ac4-fbac-fdac-3760-85189928b385.html" class="topic-link">IOJDepositManager.beginTransaction() becomes unresponsive</a></li></ul></li><li><a href="UUID-901e1ea4-0868-7aae-f60a-6bedc6ecfa0d.html" class="topic-link"><span class="glyphicon glyphicon-chevron-right"></span> SDK examples — prerequisites</a><ul><li><a href="UUID-d06944a7-6886-3d51-e69e-390225773217.html" class="topic-link">Compiling and installing examples</a></li><li><a href="UUID-ba1e99ec-4640-b4b9-0c82-2cd0bc3d569f.html" class="topic-link">Example plug-ins</a></li></ul></li><li><a href="UUID-bb541365-4925-7f31-7db5-27b9902aeeac.html" class="topic-link">SDK 3.0.0 - configuration handling</a></li><li><a href="UUID-83b41fe1-9cbd-ff16-c99f-02f4473d914a.html" class="topic-link"><span class="glyphicon glyphicon-chevron-right"></span> SDK 2.0.0</a><ul><li><a href="UUID-d5773f11-97c2-ddc9-ef78-fed8029fd98f.html" class="topic-link">New user interface framework</a></li><li><a href="UUID-636c17aa-7f0d-bffe-e77c-0ffda4bd3d3c.html" class="topic-link">Known flows launching process</a></li><li><a href="UUID-0aa70923-d132-3015-a381-2af11f2c5ef7.html" class="topic-link">SDK 2.0.0 - miscellaneous information</a></li></ul></li><li><a href="UUID-f5224b30-6ab9-7d7e-2758-993c7718b233.html" class="topic-link">Icons for services</a></li><li><a href="UUID-28d0d578-3fa4-4bc2-cb29-0f487a077613.html" class="topic-link"><span class="glyphicon glyphicon-chevron-right"></span> Purchases, payments, and kiosks</a><ul><li><a href="UUID-8398b260-6cfe-d571-f922-1cac53f59915.html" class="topic-link">CashComplete™ On-Device purchases</a></li><li><a href="UUID-7311a90b-969c-17e6-cc79-2c1844c91ce1.html" class="topic-link">Kiosk application — workflow</a></li><li><a href="UUID-9327879b-213e-e89b-9407-e2701d5f302d.html" class="topic-link">Advanced kiosk features</a></li><li><a href="UUID-2558a1cc-0b30-bc42-a498-0eb806eb80eb.html" class="topic-link">Purchase accounting</a></li></ul></li><li><a href="UUID-8c537626-5f5c-af1d-46e8-7c6feb1edec1.html" class="topic-link">Revision history</a></li></ul></li></ul></div></div><div class="col-md-9 content-container" id="content-wrapper"><a accesskey="p" id="header-navigation-prev" class="pull-left prev visible-lg visible-md" href="UUID-7311a90b-969c-17e6-cc79-2c1844c91ce1.html"><span class="glyphicon glyphicon-circle-arrow-left"></span>Prev</a><a accesskey="n" id="header-navigation-next" class="pull-right next visible-lg visible-md" href="UUID-2558a1cc-0b30-bc42-a498-0eb806eb80eb.html">Next<span class="glyphicon glyphicon-circle-arrow-right"></span></a><div id="topic-content"><section xml:lang="en" lang="en" dir="ltr" class="section" data-origin-id="UUID-1c6e27df-f704-ca48-833d-cfdc59fb8ca8" data-publication-date="" id="UUID-9327879b-213e-e89b-9407-e2701d5f302d"><div class="titlepage"><div><div class="title"><h4 class="title">Advanced kiosk features</h4></div></div></div><p>If you want more information on the advanced kiosk features, read more about the SessionKiosk example.</p><p>For more information, see <a class="xref" href="UUID-ba1e99ec-4640-b4b9-0c82-2cd0bc3d569f.html" title="Example plug-ins"><span class="xreftitle">Example plug-ins</span></a>.</p><div class="informalexample seealso"><p>See also</p><p><a class="xref" href="UUID-28d0d578-3fa4-4bc2-cb29-0f487a077613.html" title="Purchases, payments, and kiosks"><span class="xreftitle">Purchases, payments, and kiosks</span></a></p><p><a class="xref" href="UUID-ba1e99ec-4640-b4b9-0c82-2cd0bc3d569f.html" title="Example plug-ins"><span class="xreftitle">Example plug-ins</span></a></p><p><a class="xref" href="UUID-9327879b-213e-e89b-9407-e2701d5f302d.html#UUID-ebffef3a-b6f4-2453-5a47-e923866ddf3e" title="Over-payments and user credits"><span class="xreftitle">Over-payments and user credits</span></a></p><p><a class="xref" href="UUID-9327879b-213e-e89b-9407-e2701d5f302d.html#UUID-2080826b-0bd1-5d7d-b1d9-12c4b59112c1" title="Credit vouchers and redemptions"><span class="xreftitle">Credit vouchers and redemptions</span></a></p><p><a class="xref" href="UUID-9327879b-213e-e89b-9407-e2701d5f302d.html#UUID-a42c45da-3375-0d3f-3a01-a932f0602013" title="VAT"><span class="xreftitle">VAT</span></a></p><p><a class="xref" href="UUID-9327879b-213e-e89b-9407-e2701d5f302d.html#UUID-db2a2524-46de-0db7-28e7-d44d5c42086e" title="Price lists"><span class="xreftitle">Price lists</span></a></p><p><a class="xref" href="UUID-9327879b-213e-e89b-9407-e2701d5f302d.html#UUID-2aeda28b-692d-71e6-8491-9fc018f00467" title="Types of products"><span class="xreftitle">Types of products</span></a></p></div><section xml:lang="en" lang="en" dir="ltr" class="section" data-origin-id="UUID-2b9a8e10-03af-e406-5188-2c35be31ba5a" data-publication-date="" id="UUID-ebffef3a-b6f4-2453-5a47-e923866ddf3e"><div class="titlepage"><div><div class="title"><h5 class="title">Over-payments and user credits</h5></div></div></div><p>There are occasions when a customer has over-paid. There can be several reasons for an over-payment:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The customer paid by cash and didn’t have an even amount</p></li><li class="listitem"><p>The customer paid part of the amount and then cancelled</p></li><li class="listitem"><p>The system failed to deliver some of the products the customer paid for</p></li></ul></div><p>Normally, you would try to refund this in cash. After the call to doPayment() and the delivery of the products, you call payChange() and the system attempts to refund as much as possible.</p><p>There are a couple of things you need to pay attention to in this case:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Call payChange() even if doPayment() returns false, because there may be a part payment that needs to be refunded.</p></li><li class="listitem"><p>After delivering products, make sure that you call setDelivered() on the corresponding IOJProduct objects, or else their value is refunded.</p></li></ul></div><p>In some cases, the amount (or part of the amount) can’t be refunded. There can be several reasons for this, for example:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>An insufficient amount of cash in the dispensers</p></li><li class="listitem"><p>The payment form doesn’t permit refunds (only a cash payment permits refunds in cash)</p></li><li class="listitem"><p>You don’t permit refunds in cash (in which case you simply skip the call to payChange())</p></li></ul></div><p>In these cases, user credits are necessary.</p><p>When a payment has been done, the difference between the paid amount on one hand and the sum of delivered products and the refunded change on the other, is given to the currently logged in user as pending credits. This information is printed on the receipt, reported in the Purchase message, and stored in the current user object. For more information, see <a class="xref" href="UUID-9327879b-213e-e89b-9407-e2701d5f302d.html#UUID-2080826b-0bd1-5d7d-b1d9-12c4b59112c1" title="Credit vouchers and redemptions"><span class="xreftitle">Credit vouchers and redemptions</span></a>.</p><p>If a new purchase is started when the same user is still logged in, the user has pending credits (and if PaymentType.CREDITS is selected as an acceptable payment form), the kiosk app tries to first use the credits as payment.</p><p>With the following methods in the IOJUser interface, you can see the credits the current user has and you can add or remove credits:</p><pre class="programlisting">OJMoneyBag getCredits();
OJMoneyBag addCredits( Currency currency, int credits ); 
OJMoneyBag removeCredits( Currency currency, int credits ); 
void clearCredits();</pre><p>For more information, see the SessionKiosk example in <a class="xref" href="UUID-ba1e99ec-4640-b4b9-0c82-2cd0bc3d569f.html" title="Example plug-ins"><span class="xreftitle">Example plug-ins</span></a>. The example has a session where the user is kept logged in after a purchase to make more purchases until logging out. The purpose is that the user is able to use the credits.</p><div class="informalexample seealso"><p>See also</p><p><a class="xref" href="UUID-9327879b-213e-e89b-9407-e2701d5f302d.html" title="Advanced kiosk features"><span class="xreftitle">Advanced kiosk features</span></a></p><p><a class="xref" href="UUID-9327879b-213e-e89b-9407-e2701d5f302d.html#UUID-2080826b-0bd1-5d7d-b1d9-12c4b59112c1" title="Credit vouchers and redemptions"><span class="xreftitle">Credit vouchers and redemptions</span></a></p><p><a class="xref" href="UUID-ba1e99ec-4640-b4b9-0c82-2cd0bc3d569f.html" title="Example plug-ins"><span class="xreftitle">Example plug-ins</span></a></p></div></section><section xml:lang="en" lang="en" dir="ltr" class="section" data-origin-id="UUID-3102df8c-4919-44b5-4ae1-f3f86d286e98" data-publication-date="" id="UUID-2080826b-0bd1-5d7d-b1d9-12c4b59112c1"><div class="titlepage"><div><div class="title"><h5 class="title">Credit vouchers and redemptions</h5></div></div></div><p>If a user is logged out when there are pending credits, either because you always call logout() after a purchase as in SimpleKiosk, or because the user presses Logout when there are credits pending), the credits are lost.</p><p>The purchase receipts mention the credits and so does the back-end reporting. It can still be difficult to handle claims from customers who didn’t get everything expected paid out.</p><p>For this reason, there is built-in support for printing a credit voucher before logging out the user. The voucher can be brought to the kiosk owner to claim the money. The voucher also contains a reference string (included as a barcode) in order to validate it. When registering the voucher, you can supply a reference string used by your system, or you can supply null to let <span class="phrase">CashComplete™ On-Device</span> generate a universally unique string.</p><p>After registering the voucher, you just print the standard receipt called CREDITS_REFUND to print the voucher.</p><pre class="programlisting">IOJPurchaseManager purchaseManager = session.getPurchaseManager();
purchaseManager.giveVoucher( null, -1f );

try
{
    session.getDeviceManager().getPrinter().printStandardReceipt(
            OJStandardReceiptType.CREDITS_REFUND );
}
catch ( OJPrinterException e )
{
}</pre><p>The second argument to giveVoucher is <span class="guilabel">-1f</span> in the example above. This is the VAT, but in this case, you expect the user to trade the voucher for cash. In that case, there is no VAT (thus, you set it to -1).</p><p>Instead of having the users collect cash for their vouchers, you can let them redeem the voucher in the kiosk itself the next time they want to buy something. In a sense the voucher works like a loyalty card.</p><p>You need to keep the reference number returned by giveVoucher() in a database together with the amount of credits for it. When someone scans a barcode that exists in the database, you redeem the voucher and remove it from the database. <span class="phrase">CashComplete™ On-Device</span> does not maintain this database for you. It is recommended that you keep the database on a remote server so that the vouchers can be used between machines.</p><p>When used this way, you need to add VAT when registering the voucher. The reason is that you essentially sold credits to the user, just like when charging a loyalty card.</p><p>For more information, see <a class="xref" href="UUID-9327879b-213e-e89b-9407-e2701d5f302d.html#UUID-a42c45da-3375-0d3f-3a01-a932f0602013" title="VAT"><span class="xreftitle">VAT</span></a>.</p><p>Below you can see a small example snippet.</p><p>For a more comprehensive example, see the logoutUser() and setupListeners() methods in the SessionKiosk example <a class="xref" href="UUID-ba1e99ec-4640-b4b9-0c82-2cd0bc3d569f.html" title="Example plug-ins"><span class="xreftitle">Example plug-ins</span></a>.</p><div dir="ltr" class="note"><h3 class="title">Note</h3><p>The example does not have a proper database. It just keeps a simple Map in the RAM to simulate the database.</p></div><p>When the user is logging out:  </p><pre class="programlisting">OJPurchaseManager purchaseManager = session.getPurchaseManager();
String reference = purchaseManager.giveVoucher( null, 25f );

userRefundDatabase.put( reference, credits );

try
{
    session.getDeviceManager().getPrinter().printStandardReceipt(
            OJStandardReceiptType.CREDITS_REFUND );
}
catch ( OJPrinterException e )
{
}

session.getUserManager().logout();</pre><p>When a barcode is scanned:</p><pre class="programlisting">if ( userRefundDatabase.containsKey( barcode ) )
{
    // Check if there is a user logged in, otherwise login one
    if ( session.getUserManager().getCurrentUser() == null )
    {
        session.getUserManager().loginDefaultUser();
    }
    
    // Redeem the voucher, which adds the credits to the current user
    int credits = 0;
    OJMoneyBag bag = userRefundDatabase.get( barcode );
    for ( OJMoney money : bag.getMoney() )
    {
        if ( money.getCurrency().equals( CURRENCY ) )
        {
            credits += ( money.getValue() * money.getNumberOfItems() );
        }
    }
    session.getPurchaseManager().redeemVoucher( barcode, CURRENCY, credits );
    
    // Remove the refund from the database
    userRefundDatabase.remove( barcode );
}</pre><div class="informalexample seealso"><p>See also</p><p><a class="xref" href="UUID-9327879b-213e-e89b-9407-e2701d5f302d.html" title="Advanced kiosk features"><span class="xreftitle">Advanced kiosk features</span></a></p><p><a class="xref" href="UUID-9327879b-213e-e89b-9407-e2701d5f302d.html#UUID-a42c45da-3375-0d3f-3a01-a932f0602013" title="VAT"><span class="xreftitle">VAT</span></a></p><p><a class="xref" href="UUID-ba1e99ec-4640-b4b9-0c82-2cd0bc3d569f.html" title="Example plug-ins"><span class="xreftitle">Example plug-ins</span></a></p></div></section><section xml:lang="en" lang="en" dir="ltr" class="section" data-origin-id="UUID-d3c872f2-edae-cf75-3a43-3e8d1868352c" data-publication-date="" id="UUID-a42c45da-3375-0d3f-3a01-a932f0602013"><div class="titlepage"><div><div class="title"><h5 class="title">VAT</h5></div></div></div><p>VAT (Value Added Tax) is a consumption tax placed on a product whenever value is added at each stage of the supply chain, from production to the point of sale.</p><p>VAT is handled differently in different countries. For example, in the United States prices are normally shown excluding VAT. The tax is added when the product is paid. In Europe, prices are normally shown including VAT. That is, the price indicates the total amount the customer has to pay. The system must still report the VAT and the amount excluding the VAT. The reason for this is that the information is needed for accounting purposes and must be printed on the purchase receipts.  </p><p>If the VAT is 25% and the price <span class="emphasis"><em>doesn't include</em></span> VAT, the vendor must add 25% on the price. That is <span class="bold bold"><strong>price X 1.25</strong></span>. If the price including VAT is $100 then the price without VAT is $80 (because adding 25% to $80 equals $100.</p><p>If the 25% VAT <span class="emphasis"><em>is included</em></span> in the price the customer has to pay, once included it is 20% (1/5) of the total price the customer has to pay. That is <span class="bold bold"><strong>price X 0.2</strong></span>.</p><p>In a kiosk, this tends to become a bit complicated. First of all, you only add VAT when a product is paid with something that the owner makes a revenue on. For example, when the customer pays in cash or with a credit card. If the customer pays with credits, a loyalty card, or tokens, the VAT was paid when the credits or tokens were purchased.</p><p>Some types of products are also exempted from VAT. VAT is usually added to common products, such as food or clothes. But if the customer buys cash—which essentially can be regarded as cash exchange—no VAT is added. An example can be buying coins with banknotes. In this case, no VAT needs to be added because the owner doesn't make any revenue.</p><p>The situation is different if the owner makes a commission on the exchange. In that case, VAT must be added to the commission part.</p><p>VAT is added when a customer buys tokens or charges a loyalty card because that is not cash.  </p><p>It becomes even more complicated when you have purchases of both vatable (subject to VAT) and non-vatable products, such as a mix of coins and tokens. Payments can also be made with both vatable and non-vatable payment means, such as cash and a loyalty card.</p><p>The SDK purchase manager handles most of the complexity around VAT. All you need to do is to indicate the vatable price when building the price lists for the products.</p><p>For more information, see <a class="xref" href="UUID-9327879b-213e-e89b-9407-e2701d5f302d.html#UUID-db2a2524-46de-0db7-28e7-d44d5c42086e" title="Price lists"><span class="xreftitle">Price lists</span></a>.</p><p>You normally don’t need to mention the VAT, in which case it is assumed that the vatable amount is the same as the paid amount. But you can add an argument to indicate a lower vatable amount ─ or even 0. You should do this if the product is cash or something equivalent.</p><p>For a 1:1 cash exchange, you set the vatable amount to 0. If there is a commission, you set the vatable amount to the commission amount.  </p><p>For the remaining credits, the VAT depends on where the credits originated from.</p><p>For more information, see <a class="xref" href="UUID-9327879b-213e-e89b-9407-e2701d5f302d.html#UUID-2080826b-0bd1-5d7d-b1d9-12c4b59112c1" title="Credit vouchers and redemptions"><span class="xreftitle">Credit vouchers and redemptions</span></a>.</p><p>If the credits originated from a vatable payment, such as cash payment, they are considered vatable and VAT is added when the customer pays with the credits.</p><p>If the credits originated from, for example, a payment with tokens, then no VAT is added when the customer pays with the credits.</p><p>Vatable credits are always used before non-vatable credits. If you print a voucher, it indicates the VAT for the credits that were considered vatable because you essentially purchased the credits just as if you would have purchased tokens.</p><div class="informalexample seealso"><p>See also</p><p><a class="xref" href="UUID-28d0d578-3fa4-4bc2-cb29-0f487a077613.html" title="Purchases, payments, and kiosks"><span class="xreftitle">Purchases, payments, and kiosks</span></a></p><p><a class="xref" href="UUID-9327879b-213e-e89b-9407-e2701d5f302d.html" title="Advanced kiosk features"><span class="xreftitle">Advanced kiosk features</span></a></p><p><a class="xref" href="UUID-9327879b-213e-e89b-9407-e2701d5f302d.html#UUID-db2a2524-46de-0db7-28e7-d44d5c42086e" title="Price lists"><span class="xreftitle">Price lists</span></a></p><p><a class="xref" href="UUID-9327879b-213e-e89b-9407-e2701d5f302d.html#UUID-2080826b-0bd1-5d7d-b1d9-12c4b59112c1" title="Credit vouchers and redemptions"><span class="xreftitle">Credit vouchers and redemptions</span></a></p></div></section><section xml:lang="en" lang="en" dir="ltr" class="section" data-origin-id="UUID-1446f7f4-55b7-f808-8016-8246677a9a68" data-publication-date="" id="UUID-db2a2524-46de-0db7-28e7-d44d5c42086e"><div class="titlepage"><div><div class="title"><h5 class="title">Price lists</h5></div></div></div><p>When you build the list of products that can be part of a purchase, you also build a price list.</p><p>A price list contains one entry for each payment type, that is, you can have different prices for cash, loyalty card, and credit/debit card payments. If the payment is a mix of cash and loyalty card, then the loyalty card price is used. If it is a mix of cash and credit card, then the credit card price is used. It is not possible to mix loyalty card and credit card payments.  </p><p>For each price list entry, you indicate three different amounts:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The net price – The net price can be regarded as the value of the product, or the price without discounts. The net price is not what the customer will pay, and it is only used for reporting and accounting purposes.</p></li><li class="listitem"><p>The actual price – The actual price is what the customer actually pays for the product, including discounts. The actual price always includes VAT. For more information, see <a class="xref" href="UUID-9327879b-213e-e89b-9407-e2701d5f302d.html#UUID-a42c45da-3375-0d3f-3a01-a932f0602013" title="VAT"><span class="xreftitle">VAT</span></a>.</p></li><li class="listitem"><p>The vatable amount (optional) – The vatable amount is the part of the actual price on which VAT is calculated. Normally, you can exclude this amount. If you exclude this amount it is set to the same as the actual price.</p></li></ul></div><pre class="programlisting">IOJProduct product = purchaseManager.createProduct(
        "Tokens",
        "11x $1 tokens",
        // Cash price ($1 discount when buying tokens with cash):
        new OJPriceTableEntry(
                1100,
                1000 ),
        // Credit card price (no discount):
        new OJPriceTableEntry(
                1100,
                1100 ),
        // Loyalty card price (no discount):
        new OJPriceTableEntry(
                1100,
                1100 ) );</pre><p>If instead it's a cash exchange – that is, buying coins – you have to include the vatable amount and set it to 0:</p><pre class="programlisting">IOJProduct product = purchaseManager.createProduct(
        "Coins",
        "10x $1 coins",
        // Cash price (no commission):
        new OJPriceTableEntry(
                1000,   // Net price
                1000,   // Actual price
                0 ),    // Vatable amount
        // Credit card payment not allowed
        null,
        // Loyalty card payment not allowed
        null );</pre><div class="informalexample seealso"><p>See also</p><p><a class="xref" href="UUID-9327879b-213e-e89b-9407-e2701d5f302d.html" title="Advanced kiosk features"><span class="xreftitle">Advanced kiosk features</span></a></p><p><a class="xref" href="UUID-9327879b-213e-e89b-9407-e2701d5f302d.html#UUID-a42c45da-3375-0d3f-3a01-a932f0602013" title="VAT"><span class="xreftitle">VAT</span></a></p></div></section><section xml:lang="en" lang="en" dir="ltr" class="section" data-origin-id="UUID-f3028af5-55f0-bc74-9189-c41cecd6ece3" data-publication-date="" id="UUID-2aeda28b-692d-71e6-8491-9fc018f00467"><div class="titlepage"><div><div class="title"><h5 class="title">Types of products</h5></div></div></div><p>Many different types of products can be purchased in a kiosk and they are supplied to the customer in many different ways. One type of product might require a signal sent over a low level protocol, which is the case when an RS-232 bus is used. Another type of product might require calling a web service online. Other types of products might require something different. Because there is no way for <span class="phrase">CashComplete™ On-Device</span> to know which technology is in use in the kiosk, you need to manage how products are supplied. Once you have supplied the product, you need to call the setDelivered() method on the IOJProduct object to indicate that the product has been delivered.</p><p>There are a few exceptions where <span class="phrase">CashComplete™ On-Device</span> can manage the supply of products:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>If the product is cash or tokens that should be dispensed from a dispenser connected to <span class="phrase">CashComplete™ On-Device</span>.</p></li><li class="listitem"><p>If the product is a recharge of a loyalty card.</p></li></ul></div><p>In these cases, you use the standard IOJDispenseManager and IOJClosedLoopCashlessDevice interfaces to supply the products. When you call setDelivered() to indicate that the product has been supplied you can provide additional information about the products, for example, a reference to the dispense transaction or the serial number of the recharged loyalty card.</p><p>Whether it is products managed by <span class="phrase">CashComplete™ On-Device</span> or by yourself, you can always indicate that only part of the product value was supplied. For example, someone purchased 2 tokens, but only one was dispensed. In this case you can indicate a changed price for the product, and the remainder is refunded by payChange().</p><p>For more information on different cases in the different Product classes, see the SessionKiosk example <a class="xref" href="UUID-ba1e99ec-4640-b4b9-0c82-2cd0bc3d569f.html" title="Example plug-ins"><span class="xreftitle">Example plug-ins</span></a>.</p><div class="informalexample seealso"><p>See also</p><p><a class="xref" href="UUID-9327879b-213e-e89b-9407-e2701d5f302d.html" title="Advanced kiosk features"><span class="xreftitle">Advanced kiosk features</span></a></p><p><a class="xref" href="UUID-ba1e99ec-4640-b4b9-0c82-2cd0bc3d569f.html" title="Example plug-ins"><span class="xreftitle">Example plug-ins</span></a></p></div></section></section><div class="footer-content"><div class="additional-links"></div></div><footer></footer></div></div></div></div></div></div></body></html>
